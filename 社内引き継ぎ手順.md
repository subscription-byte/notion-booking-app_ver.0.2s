# 予約システム 社内引き継ぎ手順

## システム概要

- **用途**: 一般予約（対面・撮影含む）
- **特徴**:
  - 対面予約の前後2時間ブロック機能
  - 撮影タグの予約ブロック機能
  - ピンク基調の流体シミュレーション背景
  - 予約完了画面表示機能
  - リアルタイムNotionカレンダー連携

## 譲渡方法

### 方法1: フォルダごと渡す場合（推奨）

**注意**: `node_modules`と`build`フォルダは除外してください（サイズが大きいため）

1. **コマンドプロンプトで以下を実行してクリーンアップ**：
```bash
cd C:\Users\maeha\プログラム\booking-app
rmdir /s /q node_modules
rmdir /s /q build
```

2. **フォルダをZIP化して渡す**
   - booking-appフォルダを右クリック
   - 「送る」→「圧縮フォルダー」

3. **受け取った人がやること**：
```bash
# ZIPを解凍後、そのフォルダに移動して
npm install
npm start
```

### 方法2: GitHubから直接クローン（推奨）

受け取る人に以下を実行してもらう：
```bash
git clone https://github.com/tttsystem/apokanri.git
cd apokanri
npm install
npm start
```

## 現在の設定情報

### Netlifyの設定
- **サイトURL**: あなたのNetlifyサイトのURL
- **環境変数**:
  - `NOTION_TOKEN`: `[環境変数に設定されたトークン]`

### Notionの設定
- **データベースID**: `1fa44ae2d2c780a5b27dc7aae5bae1aa`
- **対応者ID**: `1ffd872b-594c-8107-b306-000269021f07`
- **Integration Token**: `[環境変数に設定されたトークン]`

### GitHubリポジトリ
- **リポジトリ**: `tttsystem/apokanri`
- **ブランチ**: `main`
- **自動デプロイ**: GitHubプッシュで自動的にNetlifyにデプロイ

## 開発環境での起動方法

### 基本コマンド

1. **初回セットアップ**
```bash
npm install
```

**ローカル開発用.envファイルの作成（必要な場合）**:
```bash
# .envファイルを作成して以下を記入
NOTION_TOKEN=[実際のトークンを設定]
```

2. **開発サーバー起動**
```bash
npm start
# → http://localhost:3000 で確認できます
```

3. **本番ビルド**
```bash
npm run build
```

### Netlify開発
```bash
# Netlify Functionsをローカルでテスト
netlify dev
# → http://localhost:8888 で確認できます
```

## よく使うコマンド

```bash
# 開発サーバー起動
npm start

# 本番用ビルド作成
npm run build

# Netlify Functionsをローカルでテスト
netlify dev

# ポートが使用中の場合
npx kill-port 3000 3001 8888

# GitHubへのプッシュ（自動デプロイ）
git add .
git commit -m "変更内容"
git push
```

## 変更が必要な箇所

### 1. 営業時間の変更
`src/components/EnhancedNotionBooking.jsx` の21-27行目付近：
```javascript
const settings = {
  immediateButtonText: '今すぐ予約する',
  startHour: 11,  // 開始時間
  endHour: 21,    // 終了時間
  systemTitle: '予約システム',
  description: 'ご希望の日時を選択してください'
};
```

### 2. 祝日の更新（2025年）
`src/components/EnhancedNotionBooking.jsx` の30-50行目付近

現在設定済みの2025年祝日：
- 1/1 元日
- 1/13 成人の日
- 2/11 建国記念の日
- 2/23 天皇誕生日
- 2/24 振替休日
- 3/20 春分の日
- 4/29 昭和の日
- 5/3 憲法記念日
- 5/4 みどりの日
- 5/5 こどもの日
- 5/6 振替休日
- 7/21 海の日
- 8/11 山の日
- 9/15 敬老の日
- 9/23 秋分の日
- 10/13 スポーツの日
- 11/3 文化の日
- 11/23 勤労感謝の日
- 11/24 振替休日

### 3. 対応者IDの変更（必要な場合）
`src/components/EnhancedNotionBooking.jsx` 170-176行目付近：
```javascript
properties['対応者'] = {
  people: [
    {
      id: '1ffd872b-594c-8107-b306-000269021f07' // ここを変更
    }
  ]
};
```

### 4. ブロック機能の設定
- **対面タグ**: 予約前後2時間を自動ブロック
- **撮影タグ**: 該当日を終日ブロック

## Netlifyへのデプロイ

GitHubにプッシュすれば自動でデプロイされます：
```bash
git add .
git commit -m "変更内容"
git push
```

## トラブルシューティング

### npm installでエラーが出る場合
```bash
# package-lock.jsonを削除してやり直す
del package-lock.json
npm install
```

### ポートが使用中の場合
```bash
npx kill-port 3000 3001 8888
```

### Netlifyでエラーが出る場合
- Netlifyの管理画面で環境変数`NOTION_TOKEN`が設定されているか確認
  - 値: `[実際のトークンを設定]`
- デプロイログを確認
- Build settingsが正しいか確認

### Notion APIエラーの場合
1. インテグレーションのアクセス権限確認
2. データベースIDが正しいか確認
3. 対応者IDが存在するか確認
4. Notion側でインテグレーションが該当データベースに接続されているか確認

### 予約が作成されない場合
1. ブラウザの開発者ツール（F12）でエラーを確認
2. Netlify Functionsのログを確認
3. CORS設定を確認

## ファイル構成

```
booking-app/
├── src/
│   ├── components/
│   │   ├── EnhancedNotionBooking.jsx  # メインコンポーネント
│   │   ├── FluidCanvas.jsx           # 背景アニメーション
│   │   └── NotionBookingSystem.jsx   # 旧バージョン（参考用）
│   ├── App.js
│   └── index.js
├── netlify/
│   └── functions/
│       ├── notion-query.js    # Notion検索API
│       └── notion-create.js   # Notion作成API
├── public/
│   ├── index.html
│   └── favicon.ico
└── package.json
```

## 主な機能

1. **リアルタイム空き状況確認**
   - Notionカレンダーと連携
   - 1時間ごとのタイムスロット表示

2. **自動ブロック機能**
   - 対面予約の前後2時間をブロック
   - 撮影予約の終日ブロック

3. **予約完了画面**
   - 予約内容の確認表示
   - アニメーション付き完了通知

4. **レスポンシブデザイン**
   - モバイル対応
   - タッチ操作対応の背景エフェクト

## 連絡先

何か問題があれば連絡してください。
GitHubのリポジトリへのアクセス権限が必要な場合は申請してください。

---
最終更新日: 2025年1月19日
引き継ぎ日: 2025年1月